- name: Completely Remove Watch Targets and Dependencies (Ruby)
        run: |
          ruby -e "
          require 'xcodeproj'
          path = 'FreeAPS.xcodeproj'
          project = Xcodeproj::Project.open(path)
          
          # 1. Entferne die Watch-Ziele
          project.targets.dup.each do |target|
            if target.name.downcase.include?('watch')
              puts \"Entferne Target: #{target.name}\"
              target.remove_from_project
            end
          end

          # 2. Entferne die 'Embed Watch Content' Build Phase beim Haupt-Target
          main_target = project.targets.find { |t| t.name == 'FreeAPS' }
          if main_target
            main_target.build_phases.dup.each do |phase|
              # Wir löschen die Phase, die versucht Watch-Apps zu kopieren
              if phase.respond_to?(:name) && phase.name =~ /Watch/i
                puts \"Entferne Build Phase: #{phase.name}\"
                phase.remove_from_project
              end
              # Sicherheitshalber auch Kopier-Phasen prüfen, die Watch-Dateien enthalten
              if phase.isa == 'PBXCopyFilesBuildPhase' && phase.symbolic_path == :watch_app
                 puts \"Entferne Watch Copy Phase\"
                 phase.remove_from_project
              end
            end
          end
          
          project.save
          
          # 3. Auch in LoopKit aufräumen
          if File.exist?('LoopKit/LoopKit.xcodeproj')
            lk_project = Xcodeproj::Project.open('LoopKit/LoopKit.xcodeproj')
            lk_project.targets.dup.each do |t|
              t.remove_from_project if t.name.downcase.include?('watch')
            end
            lk_project.save
          end
          "
